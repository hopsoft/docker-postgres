#!/bin/bash

apt-get -y --force-yes install lsb-release
echo deb http://archive.ubuntu.com/ubuntu $(lsb_release -cs) main universe > /etc/apt/sources.list.d/universe.list
echo deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main > /etc/apt/sources.list.d/pgdg.list
echo deb http://ppa.launchpad.net/ubuntugis/ppa/ubuntu $(lsb_release -cs) main > /etc/apt/sources.list.d/gis.list
apt-get -q -y --force-yes update
apt-get -y --force-yes install \
  build-essential \
  postgresql-9.3 \
  postgresql-client-9.3 \
  postgresql-contrib-9.3 \
  libpq-dev

# posgis setup
#cd /usr/local/src
#wget --quiet http://download.osgeo.org/gdal/1.10.1/gdal-1.10.1.tar.gz
#tar xzf gdal-1.10.1.tar.gz
#cd /usr/local/src/gdal-1.10.1
#./configure
#make
#make install
#
#apt-get -y --force-yes install postgresql-9.3-postgis

cp /opt/hopsoft/postgres/my_init.d/01_init_postgres.sh /etc/my_init.d/01_init_postgres.sh
mkdir -p /etc/service/postgres
cp /opt/hopsoft/postgres/daemons/postgres.sh /etc/service/postgres/run

cp /opt/hopsoft/postgres/logrotate /etc/logrotate.d/postgres
chmod 644 /etc/logrotate.d/postgres

apt-get clean
rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*

